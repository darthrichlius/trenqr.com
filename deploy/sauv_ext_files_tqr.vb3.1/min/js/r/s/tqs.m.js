(function(){var _cvs,_ctx,_img,_file,_CpDs={},_ci,tqse=$("<span/>");var DEBUG={};var EVENT={names:{"tqr.downloadingStart":"tqr.downloadingStart","tqr.downloadingEnd":"tqr.downloadingEnd","tqs.loadingStart":"tqs.loadingStart","tqs.loadingEnd":"tqs.loadingEnd","tqr.renderingStart":"tqr.renderingStart","tqr.renderingEnd":"tqr.renderingEnd","tqs.applyingStart":"tqs.applyingStart","tqs.applyingEnd":"tqs.applyingEnd","tqs.abortingStart":"tqs.abortingStart","tqs.abortingEnd":"tqs.abortingEnd","tqs.resetingStart":"tqs.resetingStart",
"tqs.resetingEnd":"tqs.resetingEnd"},createNew:function(nm,opts){try{if(KgbLib_CheckNullity(nm))return;switch(nm){case "tqr.downloadingStart":case "tqr.downloadingEnd":case "tqs.loadingStart":case "tqs.loadingEnd":case "tqs.MenuSwitchingStart":case "tqs.MenuSwitchingEnd":case "tqs.applyingStart":case "tqs.applyingEnd":case "tqs.renderingStart":case "tqs.renderingEnd":case "tqs.abortingStart":case "tqs.abortingEnd":case "tqs.resetingStart":case "tqs.resetingEnd":return new CustomEvent(nm,opts);break;
default:return}}catch(ex){Kxlib_DebugVars([ex,ex.fileName,ex.lineNumber],true)}},declareEvent:function(e,d,o){try{if(KgbLib_CheckNullity(e))return;var ev=!e instanceof CustomEvent?this.createNew(e,o):e;if(!ev)return false;var ds=!d?[]:[d];$(tqse).trigger(ev,ds)}catch(ex){Kxlib_DebugVars([ex,ex.fileName,ex.lineNumber],true)}}};var CCF={onChangeGetValue:function(x,a,gx){try{if(KgbLib_CheckNullity(x)|KgbLib_CheckNullity(a)|KgbLib_CheckNullity(gx))return;var vl,min,max;vl=$(x).is(".jb-tqs-cstmclr-rng")?
parseFloat($(x).val()):parseFloat($(gx).find(".jb-tqs-cstmclr-rslt").text());min=$(gx).find(".jb-tqs-cstmclr-rng").prop("min");max=$(gx).find(".jb-tqs-cstmclr-rng").prop("max");if(a!=="range")vl=a==="minus"?--vl:++vl;if(vl<min)vl=min;else if(vl>max)vl=max;return vl}catch(ex){Kxlib_DebugVars([ex,ex.fileName,ex.lineNumber],true)}},onChangeSetValue:function(x,e,v){try{if(KgbLib_CheckNullity(x)|KgbLib_CheckNullity(e)|KgbLib_CheckNullity(v))return;var mb=$(".jb-tqs-grpact[data-gpaction='"+e+"']"),vl;vl=
parseFloat(v);$(mb).find(".jb-tqs-cstmclr-rng").val(vl);$(mb).find(".jb-tqs-cstmclr-rslt").text(vl)}catch(ex){Kxlib_DebugVars([ex,ex.fileName,ex.lineNumber],true)}},effectGetValue:function(e){try{if(KgbLib_CheckNullity(e))return;var vl=$(".jb-tqs-grpact[data-gpaction='"+e+"']").find(".jb-tqs-cstmclr-rslt").text();vl=e==="gamma"?parseInt(vl):parseFloat(vl);return vl}catch(ex){Kxlib_DebugVars([ex,ex.fileName,ex.lineNumber],true)}}};var CPF={tqsToCamanName:function(nm){try{if(KgbLib_CheckNullity(nm))return;
nm=nm.toLowerCase();if($.inArray(nm,Object.keys(_f_Gdf().filter_preset.caman))!==-1)return _f_Gdf().filter_preset.caman[nm];else if($.inArray(nm,Object.keys(_f_Gdf().filter_preset.customs))!==-1)return _f_Gdf().filter_preset.customs[nm];else return}catch(ex){Kxlib_DebugVars([ex,ex.fileName,ex.lineNumber],true)}}};var _f_Gdf=function(){var dt={EVENT:["tqs.loadingStart","tqs.loadingEnd","tqs.applyingStart","tqs.applyingEnd","tqs.abortingStart","tqs.abortingEnd","tqr.downloadingStart","tqr.downloadingEnd",
"tqs.savingStart","tqs.savingEnd","tqs.resetingStart","tqs.resetingEnd"],menus:["custom_filter","custom_color","custom_cropping"],grpactn:{all:["dragmove","rotate","zoom","reverse","brightness","contrast","saturation","vibrance","hue","gamma","clip","stackBlur","exposure","sepia","noise","sharpen"],cropping:["dragmove","rotate","zoom","reverse"],filter_color:["brightness","contrast","saturation","vibrance","hue","gamma","clip","stackBlur","exposure","sepia","noise","sharpen"]},filter_preset:{caman:{"arashiyama":"jarques",
"baikal":"clarity","brazzaville":"nostalgia","edisson":"vintage","londres":"crossProcess","koala":"emboss","lalibela":"lomo","le_caire":"glowingSun","gorges_diosso":"orangePeel","gotham":"grungy","hemingway":"hemingway","hillier":"herMajesty","moscou":"hazyDays","mars":"love","minas_tirith":"pinhole","ouarzazate":"sunrise","paris":"oldBoot","radial":"radialBlur","tarantino":"sinCity","kanga_moussa":"concentrate","yingyang":"greyscale"},customs:{"hdr_effect":"hdr_effect","old_paper":"old_paper","notre_dame":"notre_dame"}}};
return dt};var _f_Action=function(x,a){try{if(KgbLib_CheckNullity(x)|(KgbLib_CheckNullity($(x).data("action"))&&KgbLib_CheckNullity(a))|(KgbLib_CheckNullity($(x).closest(".jb-tqs-grpact").data("gpaction"))&&$(x).data("gpaction"))|!_cvs)return;var ac=a?a:$(x).data("action");var gax=$(x).closest(".jb-tqs-grpact"),ga=$(gax).data("gpaction");if($.inArray(ga,_f_Gdf().grpactn.filter_color)!==-1)var CCF_PV=CCF.onChangeGetValue(x,ac,gax);_f_Dply_WP(true);var sac;if($(x).is(".jb-tqs-cstmclr-rng")||$(x).is(".jb-tqs-cstmclr-actn-btn")){EVENT.declareEvent("tqs.applyingStart",
null,{mod:"custom_color"});sac=ga}else if($(x).is(".jb-tqs-cstmfltr-actn-btn")){EVENT.declareEvent("tqs.applyingStart",null,{mod:"custom_filter"});sac=CPF.tqsToCamanName($(x).data("option"))}else{EVENT.declareEvent("tqs.applyingStart",null,{mod:"custom_cropping"});sac=ac}switch(sac){case "back_raw":_f_RstCvs(x,ga);break;case "erase":_f_Erz(x);break;case "download":_f_Dwnld(x);break;case "menu_selector":_f_MnSlctr();break;case "dragmode":var vl=$(x).data("option");$(".jb-tqs-canvas").one("crop.cropper",
function(){EVENT.declareEvent("tqs.renderingEnd",null,{mod:"custom_cropping"})}).cropper("setDragMode",vl);case "ratio":var vl=parseFloat($(x).data("option"));$(".jb-tqs-canvas").one("crop.cropper",function(){EVENT.declareEvent("tqs.renderingEnd",null,{mod:"custom_cropping"})}).cropper("setAspectRatio",vl);break;case "rotate":case "zoom":var vl=$(x).data("option");$(".jb-tqs-canvas").one("crop.cropper",function(){EVENT.declareEvent("tqs.renderingEnd",null,{mod:"custom_cropping"})}).cropper(sac,vl);
break;case "reverse":var sx,sy,op=$(x).data("option");if(op==="x"){sx=_CpDs["scaleX"]===-1?1:-1;sy=_CpDs["scaleY"]}else{sx=_CpDs["scaleX"];sy=_CpDs["scaleY"]===-1?1:-1}$(".jb-tqs-canvas").one("crop.cropper",function(){EVENT.declareEvent("tqs.renderingEnd",null,{mod:"custom_cropping"})}).cropper("scale",sx,sy);break;case "jarques":case "clarity":case "nostalgia":case "vintage":case "crossProcess":case "emboss":case "lomo":case "glowingSun":case "orangePeel":case "grungy":case "hemingway":case "herMajesty":case "hazyDays":case "love":case "pinhole":case "sunrise":case "oldBoot":case "radialBlur":case "sinCity":case "concentrate":case "greyscale":case "old_paper":_ci=
Caman(".jb-tqs-canvas",_img,function(){this.revert(false);this[sac]();this.render()});break;case "notre_dame":_ci=Caman(".jb-tqs-canvas",_img,function(){this.revert(false);this.colorize(60,105,218,10);this.contrast(10);this.sunrise();this.hazyDays();this.render()});break;case "hdr_effect":_ci=Caman(".jb-tqs-canvas",_img,function(){this.revert(false);this.contrast(10);this.contrast(10);this.jarques();this.render()});break;case "brightness":case "clip":case "contrast":case "exposure":case "gamma":case "hue":case "noise":case "saturation":case "sepia":case "sharpen":case "stackBlur":case "vibrance":var br=
sac==="brightness"?CCF_PV:CCF.effectGetValue("brightness");var cl=sac==="clip"?CCF_PV:CCF.effectGetValue("clip");var ct=sac==="contrast"?CCF_PV:CCF.effectGetValue("contrast");var xp=sac==="exposure"?CCF_PV:CCF.effectGetValue("exposure");var gm=sac==="gamma"?CCF_PV:CCF.effectGetValue("gamma");var he=sac==="hue"?CCF_PV:CCF.effectGetValue("hue");var nz=sac==="noise"?CCF_PV:CCF.effectGetValue("noise");var st=sac==="saturation"?CCF_PV:CCF.effectGetValue("saturation");var sp=sac==="sepia"?CCF_PV:CCF.effectGetValue("sepia");
var sn=sac==="sharpen"?CCF_PV:CCF.effectGetValue("sharpen");var sb=sac==="stackBlur"?CCF_PV:CCF.effectGetValue("stackBlur");var vb=sac==="vibrance"?CCF_PV:CCF.effectGetValue("vibrance");gm=gm===0?1:gm;_ci=Caman(".jb-tqs-canvas",_img,function(){this.revert(false);if(sac==="sharpen")this.brightness(br).clip(cl).contrast(ct).exposure(xp).gamma(gm).hue(he).noise(nz).saturation(st).sepia(sp).sharpen(sn).stackBlur(sb).vibrance(vb);else if(sac==="hue")this.brightness(br).clip(cl).contrast(ct).exposure(xp).gamma(gm).hue(he).noise(nz).saturation(st).sepia(sp).stackBlur(sb).vibrance(vb);
else this.brightness(br).clip(cl).contrast(ct).exposure(xp).gamma(gm).noise(nz).saturation(st).sepia(sp).stackBlur(sb).vibrance(vb);this.render()});CCF.onChangeSetValue(x,sac,CCF_PV);break;case "apply":_f_Apply();break;case "abort":_f_Prvs();break;default:return}}catch(ex){Kxlib_DebugVars([ex,ex.fileName,ex.lineNumber],true)}};var _f_Apply=function(){try{var mn=_f_GtNwMn(true).val();switch(mn){case "custom_cropping":EVENT.declareEvent("tqs.applyingStart",null,{mod:mn});var daul=$(".jb-tqs-canvas").cropper("getCroppedCanvas").toDataURL();
_f_UpdCvs(daul);break;case "custom_color":case "custom_filter":EVENT.declareEvent("tqs.applyingStart",null,{mod:mn});var daul=_cvs.toDataURL();_f_UpdCvs(daul);break;default:return}}catch(ex){Kxlib_DebugVars([ex,ex.fileName,ex.lineNumber],true)}};var _f_Prvs=function(){try{var mn=_f_GtNwMn(true);if(!mn)return;mn=mn.val();switch(mn){case "custom_filter":_ci=Caman(".jb-tqs-canvas",_img,function(){this.revert();EVENT.declareEvent("tqs.applyingEnd",null,{mod:mn})});break;case "custom_color":_ci=Caman(".jb-tqs-canvas",
_img,function(){this.revert();EVENT.declareEvent("tqs.applyingEnd",null,{mod:mn})});$(".jb-tqs-cstmclr-rng").val(0);$(".jb-tqs-cstmclr-rslt").text(0);break;case "custom_cropping":$(".jb-tqs-canvas").one("crop.cropper",function(e){EVENT.declareEvent("tqs.applyingEnd",null,{mod:mn})}).cropper("reset");break;default:return}}catch(ex){Kxlib_DebugVars([ex,ex.fileName,ex.lineNumber],true)}};var _f_LoadImg=function(file){try{if(KgbLib_CheckNullity(file))return;$(".jb-tqs-invitation-mx").addClass("this_hide");
$(".jb-tqs-canvas").removeClass("this_hide");var URL=window.URL||window.webkitURL;if(URL){if(!/^image\/\w+$/.test(file.type))alert("Ce fichier n'est pas une image !");$(".jb-tqs-scrn-bdy-blcs[data-section='right']").removeClass("this_hide");$(".jb-tqs-top-opt-actn[data-action='erase']").removeClass("this_hide");_file=file;_f_UpdCvs(URL.createObjectURL(file),true)}}catch(ex){Kxlib_DebugVars([ex,ex.fileName,ex.lineNumber],true)}};var _f_UpdCvs=function(daul,isld){try{if(KgbLib_CheckNullity(daul))return;
var canvas=_cvs=$(".jb-tqs-canvas")[0];var ctx=_ctx=canvas.getContext("2d");img=new Image;img.onload=function(){$image=$(img);var dims=_f_CvsFit(img.width,img.height);canvas.width=dims.width;canvas.height=dims.height;ctx.drawImage(img,0,0,dims.width,dims.height);_img=img;var mn=_f_GtNwMn(true).val();if(mn==="custom_cropping")$(".jb-tqs-canvas").one("built.cropper",function(){if(isld)EVENT.declareEvent("tqs.applyingEnd",null,{mod:mn});else EVENT.declareEvent("tqs.applyingEnd",null,{mod:mn})}).cropper({aspectRatio:1/
1,responsive:false,highlight:false}).cropper("reset").cropper("replace",img.src);else EVENT.declareEvent("tqs.applyingEnd",null,{mod:mn});$(".jb-tqs-canvas").removeAttr("data-caman-id");$(".jb-tqs-top-opt-act-ipt").val("")};img.src=daul}catch(ex){Kxlib_DebugVars([ex,ex.fileName,ex.lineNumber],true)}};var _f_CvsFit=function(w,h){try{if(KgbLib_CheckNullity(w)|KgbLib_CheckNullity(h))return;var hs={"header":60,"nav":40,"padding":50};var wh=$(window).height();var wd__=wh-hs.header-hs.nav-hs.padding;wd__=
wd__>$(".jb-tqs-scrn-bdy-ctr-bdy").width()?$(".jb-tqs-scrn-bdy-ctr-bdy").width():wd__;var coef=h>w?wd__/h:wd__/w;var dims={height:h*coef,width:w*coef};return dims}catch(ex){Kxlib_DebugVars([ex,ex.fileName,ex.lineNumber],true)}};var _f_MnSlctr=function(){try{var mn=_f_GtNwMn(true).val();$(".jb-tqs-scrn-ctrl-grpact-bmx").addClass("this_hide");$(".jb-tqs-scrn-ctrl-grpact-bmx[data-scp='"+mn+"']").removeClass("this_hide");switch(mn){case "custom_cropping":$(".jb-tqs-canvas").one("built.cropper",function(){EVENT.declareEvent("tqs.menuSwitchingEnd",
null,{mod:mn})}).cropper({aspectRatio:1/1,responsive:false,highlight:false,crop:function(e){_CpDs["x"]=e.x;_CpDs["y"]=e.y;_CpDs["width"]=e.width;_CpDs["height"]=e.height;_CpDs["rotate"]=e.rotate;_CpDs["scaleX"]=e.scaleX;_CpDs["scaleY"]=e.scaleY}}).cropper("reset").cropper("replace",_img.src);break;case "custom_color":case "custom_filter":$(".jb-tqs-canvas").cropper("destroy");Caman(".jb-tqs-canvas",_img,function(){this.revert(false);this.render(function(){EVENT.declareEvent("tqs.menuSwitchingEnd",
null,{mod:mn})})});break;default:return}}catch(ex){Kxlib_DebugVars([ex,ex.fileName,ex.lineNumber],true)}};var _f_GtNwMn=function(aso){try{var $so=$(".jb-tqs-scrn-ctrl-mn-slct option:selected");return aso?$so:$so.text()}catch(ex){Kxlib_DebugVars([ex,ex.fileName,ex.lineNumber],true)}};var _f_RstCvs=function(x,ga){try{if(KgbLib_CheckNullity(x)|KgbLib_CheckNullity(ga))return;_f_UpdCvs(URL.createObjectURL(_file));var mn=_f_GtNwMn(true);if(!mn)return;mn=mn.val();switch(mn){case "custom_filter":_ci=Caman(".jb-tqs-canvas",
_img,function(){this.revert()});break;case "custom_color":_ci=Caman(".jb-tqs-canvas",_img,function(){this.revert()});$(".jb-tqs-cstmclr-rng").val(0);$(".jb-tqs-cstmclr-rslt").text(0);break;case "custom_cropping":$(".jb-tqs-canvas").cropper("reset");break;default:return}}catch(ex){Kxlib_DebugVars([ex,ex.fileName,ex.lineNumber],true)}};var _f_Erz=function(x){try{if(KgbLib_CheckNullity(x))return;if($(x).data("lk")===1)return;$(x).data("lk",1);_ctx.clearRect(0,0,_cvs.width,_cvs.height);var mn=_f_GtNwMn(true);
if(!mn)return;mn=mn.val();switch(mn){case "custom_filter":break;case "custom_color":$(".jb-tqs-cstmclr-rng").val(0);$(".jb-tqs-cstmclr-rslt").text(0);break;case "custom_cropping":$(".jb-tqs-canvas").cropper("destroy");$(".cropper-hide").remove();break;default:return}$(".jb-tqs-canvas").remove();$("<canvas/>",{id:"tqs-canvas",class:"jb-tqs-canvas this_hide"}).insertAfter(".jb-tqs-invitation-mx");_cvs=null;_ctx=null;_img=null;_file=null;$(x).addClass("this_hide");$(x).data("lk",0);$(".jb-tqs-invitation-mx").removeClass("this_hide");
$(".jb-tqs-scrn-bdy-blcs[data-section='right']").addClass("this_hide");EVENT.declareEvent("tqs.applyingEnd",null,{mod:mn})}catch(ex){Kxlib_DebugVars([ex,ex.fileName,ex.lineNumber],true)}};var _f_Dwnld=function(x){try{if(KgbLib_CheckNullity(x))return;var mn=_f_GtNwMn(true);if(!mn)return;mn=mn.val();switch(mn){case "custom_cropping":case "custom_color":case "custom_filter":var b=$(".jb-tqs-canvas")[0].toDataURL(_file.type),lk=$(x)[0];var fn=_file.name.replace(/^.*\/|\.[^.]*$/g,""),xt=_file.type.replace(/^image\/(\w+)$/,
".$1");xt=xt===".jpeg"?".jpg":xt;lk.href=b;lk.download=fn.concat("_by_trenqr_studio",xt);setTimeout(function(){lk.href="javascript:;";$(x).removeProp("download");EVENT.declareEvent("tqr.downloadingEnd",null,{mod:mn})},1E3);break;default:return}}catch(ex){Kxlib_DebugVars([ex,ex.fileName,ex.lineNumber],true)}};var _f_Dply_WP=function(shw){try{if(shw===true)$(".jb-tqs-wait-pnl-mx").removeClass("this_hide");else $(".jb-tqs-wait-pnl-mx").addClass("this_hide")}catch(ex){Kxlib_DebugVars([ex,ex.fileName,
ex.lineNumber],true)}};Caman.Event.listen("renderFinished",function(){EVENT.declareEvent("tqs.renderingEnd",null,{mod:"custom_filter"})});$(".jb-tqs-canvas").on({"build.cropper":function(e){console.log("CROPPER : ",e.type)},"cropstart.cropper":function(e){console.log("CROPPER : ",e.type,e.action)},"cropmove.cropper":function(e){console.log("CROPPER : ",e.type,e.action)},"cropend.cropper":function(e){console.log("CROPPER : ",e.type,e.action)},"crop.cropper":function(e){console.log("CROPPER : ",e.type,
e.x,e.y,e.width,e.height,e.rotate,e.scaleX,e.scaleY)},"zoom.cropper":function(e){console.log("CROPPER : ",e.type,e.ratio)},"built.cropper":function(e){console.log("CROPPER : ",e.type)}});$(tqse).on({"tqr.downloadingStart":function(e){_f_Dply_WP(true)},"tqr.downloadingEnd":function(e){_f_Dply_WP()},"tqs.loadingStart":function(e){_f_Dply_WP(true)},"tqs.loadingEnd":function(e){_f_Dply_WP()},"tqs.menuSwitchingStart":function(e){_f_Dply_WP(true)},"tqs.menuSwitchingEnd":function(e){_f_Dply_WP()},"tqs.renderingStart":function(e){_f_Dply_WP(true)},
"tqs.renderingEnd":function(e){_f_Dply_WP()},"tqs.applyingStart":function(e){_f_Dply_WP(true)},"tqs.applyingEnd":function(e){_f_Dply_WP()},"tqs.abortingStart":function(e){_f_Dply_WP(true)},"tqs.abortingEnd":function(e){_f_Dply_WP()},"tqs.resetingStart":function(e){_f_Dply_WP(true)},"tqs.resetingEnd":function(e){_f_Dply_WP()}});$(".jb-tqs-top-opt-act-ipt").change(function(e){var file=this.files[0];_f_LoadImg(file)});$(".jb-tqs-scrn-ctrl-mn-slct").change(function(e){var x=this,a="menu_selector";_f_Action(this,
"menu_selector")});$(".jb-tqs-cstmclr-rng").change(function(e){_f_Action(this)});$(".jb-tqs-cstmclr-actn-btn, .jb-tqs-crop-actn-btn, .jb-tqs-top-opt-actn:not([data-action=upload]), .jb-tqs-cstmfltr-actn-btn").click(function(e){if(!$(this).is(".jb-tqs-top-opt-actn[data-action=download]"))Kxlib_PreventDefault(e);_f_Action(this)});$(".jb-tqs-pre-fnl-action").click(function(e){Kxlib_PreventDefault(e);_f_Action(this)});$(window).resize(function(e){var pw=$(this).width();var mn=_f_GtNwMn(true).val();if(_img){var dims=
_f_CvsFit(_img.width,_img.height);console.log("MENU : ",mn,"WIDTH : ",dims.width,"HEIGHT",dims.height);_cvs.width=dims.width;_cvs.height=dims.height;_ctx.drawImage(_img,0,0,dims.width,dims.height);if(mn&&mn==="custom_cropping"){var $image=$(".jb-tqs-canvas");$image.cropper("destroy");clearTimeout(ti);var ti=setTimeout(function(){if($(window).width()===pw||screen.width===pw)$image.cropper({aspectRatio:1/1,highlight:false}).cropper("reset")},200)}}})})();
